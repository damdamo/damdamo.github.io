<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Damien Morard - Enjoy Programming (and even more...)</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="I share my passion about Computer Science and programming. You can find posts about my research, some tutorials in programming, or just sharing my knowledge. I particularly use the Swift language, created by Apple."> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script async defer src="https://buttons.github.io/buttons.js"></script> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous"> <!-- <script> (function(d, h, m){ var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)){return;} js = d.createElement(h); js.id = m; js.onload = function(){ window.makerWidgetComInit({ position: "right", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" })}; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs) }(document, "script", "dhm")) </script> --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-7259836434848202", enable_page_level_ads: true }); </script> </head> <body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <div class="col-md-2 center"> <a href="/"> <img src="/assets/img/general/ma_tete.png" class="profile-img"> </a> </div> <div class="col-md-4 center"> <h1 class="profile-name"> Damien Morard</h1> <p class="profile-bio"> Enjoy Programming (and even more...)</p> <p class="profile-links"> <a class="social-link" href="http://medium.com/@dmorard1"> <i class="fab fa-medium-m"></i> </a> <a class="social-link" href="http://github.com/damdamo"> <i class="fab fa-github"></i> </a> <a class="social-link" href="http://linkedin.com/in/damienmorard"> <i class="fab fa-linkedin-in"></i> </a> </p> </div> <div class="col-md-6 center"> <ul class="nav justify-content-end" id="navigation"> </ul> <ul class="nav justify-content-end" id="navigation"><li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li><li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li><li class="nav-item"> <a class="nav-link" href="/">About</a> </li><li class="nav-item"> <a class="nav-link" href="/publications">Publications</a> </li></ul></div> </div> </div> </header> <div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog">Blog</a> </li> <li class="breadcrumb-item"> <a href="/blog/categories">Categories</a> </li> <li class="breadcrumb-item active" aria-current="page">Les closures, l'application partielle et la curryfication (Partie 1/3) (Swift)</li> </ol> </nav> <div class="row"> <div class="col-lg-8"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <!-- <h1 class="post-title" itemprop="name headline">Les closures, l'application partielle et la curryfication (Partie 1/3) (Swift)</h1> --> <h4 class="post-meta">Introduction aux closures</h4> <p class="post-summary">Posted by : <img src="/assets/img/general/ma_tete.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Damien</span> </span> at <time datetime="2019-08-09 00:00:00 +0000" itemprop="datePublished">Aug 9, 2019</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/tutorial/2019/08/09/closure-fr.html"></span> <div class="post-categories"> Category : <a href="/blog/categories/tutorial">tutorial</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/blog/poupee_russe.jpg" alt=""> <p>Disponible sur <a href="https://medium.com/@dmorard1/fermeture-closure-application-partielle-et-curryfication-en-swift-partie-1-3-4c2c6f2bce67">Medium</a>.</p> <h2 id="introduction">Introduction</h2> <p>Ce titre vous fait peur ? Ou plutôt les notions abordées sont effrayantes ? Ne fuyez pas et prenez le temps à mes côtés de démystifier ses concepts, comprendre le fonctionnement derrière ce qui peut vous sembler être de la magie.</p> <h2 id="bienvenue-dans-le-monde-fantastique-des-closures-ou-fermetures">Bienvenue dans le monde fantastique des closures (ou fermetures)</h2> <p>Qu’est-ce que nous dit la documentation <a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html">Swift</a> à ce sujet ?</p> <blockquote> <p>“Closures are self-contained blocks of functionality that can be passed around and used in your code.”</p> </blockquote> <blockquote> <p>“Les closures sont des blocs autonomes composés de fonctionnalités pouvant être passées et utilisées dans votre code”.</p> </blockquote> <p>Finalement, c’est pas un peu comme une boîte à outils ? Dans cette boîte nous pouvons imaginer avoir des outils, et les manipuler nous permet d’obtenir/modifier certaines pièces. Cette définition reste un peu générale, mais la documentation ne s’arrête pas là:</p> <blockquote> <p>“Closures can capture and store references to any constants and variables from the context in which they are defined.”</p> </blockquote> <blockquote> <p>“Les closures peuvent capturer et enregistrer des références pour n’importe quelles constantes ou variables du contexte dans laquelles elles sont définies.”</p> </blockquote> <p>Je pense que nous avons besoin de clarifier certaines notions de ces définitions pour bien comprendre la théorie. Une closure c’est un peu comme un environnement, une mémoire qui va garder des valeurs que nous avons défini à l’intérieur. C’est comme quand vous déclarez des variables, sauf qu’elles seront seulement accessible dans une certaine portée. Je crois qu’un petit exemple ne fera pas de mal:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="c1">// 3</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// Use of unresolved identifier 'x'</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div> <p>Dans ce petit exemple, nous avons une fonction “<em>foo</em>” qui déclare à l’intérieur une variable “<em>x</em>”. Cette variable est visible seulement à l’intérieur de notre fonction, une fois sortie celle-ci n’existe plus. C’est la même chose pour une closure ! Nous avons donc des variables, et des fonctionnalités qui ne sont rien d’autre que des fonctions.</p> <p>Nous aurons l’occasion un peu plus tard de revenir en détail sur les closures. Pour l’heure, regardons comment nous pouvons les manipuler en Swift.</p> <p>Qu’est-ce que Swift nous dit-il par rapport à la représentation syntaxique des closures ?</p> <blockquote> <p>“Closure expression syntax has the following general form:”</p> </blockquote> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">return</span> <span class="n">type</span> <span class="k">in</span>
    <span class="n">statements</span>
<span class="p">}</span>
</code></pre></div></div> <p>Cette syntaxe vous a l’air peut-être rude, et c’est sûrement le premier point qui fait défaut quand nous désirons manipuler des closures. Il faut avant tout comprendre la syntaxe pour l’utiliser convenablement.</p> <p>Prenons un petit exemple en utilisant ce que nous venons de voir.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">clos</span> <span class="o">=</span> <span class="p">{(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>

<span class="c1">// Retourne 42</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">clos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
</code></pre></div></div> <p>Nous pouvons voir une closure comme une fonction sans nom, qui est appelée grâce à la variable à laquelle elle a été liée (clos dans notre cas). Comme une fonction nous avons des paramètres d’entrée, le type de ces paramètres et le type de sortie. Plutôt que d’avoir la syntaxe des accolades pour séparer la signature et le corps de la fonction, nous avons le mot-clé “<em>in</em> “. Nous avons pour terminer la valeur de retour que nous signalons aussi avec le mot-clé “<em>return</em> “. L’appel de cette closure se fait exactement de la même manière que si le nom de notre fonction était <em>clos</em>. C’est-à-dire qu’il nous suffit de passer à notre closure les paramètres attendus. Vous aurez compris que notre closure fait simplement l’addition de nos deux paramètres, rien de très passionnant n’est-ce pas ?</p> <p>Passons un cran au-dessus en supposant que nous avons cette fois une fonction prenant en paramètre une closure !</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">apply</span><span class="p">(</span><span class="n">_</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span><span class="n">_</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Nous avons désormais la fonction <em>apply</em>, qui prend deux entiers et va appliquer une opération sur ceux-ci. Il faut être au clair sur la notation “<em>op: (Int, Int) -&gt; Int</em> “. Cela signifie que le paramètre <em>op</em> attend une fonction ou une closure qui prend deux entiers comme paramètres d’entrée, et retourne un entier. Vous l’avez peut-être remarqué, mais la closure que nous avons écrite avant répond parfaitement à ces conditions. Nous pouvons donc simplement appelée notre fonction ainsi :</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Retourne 42</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="n">clos</span><span class="p">))</span>
</code></pre></div></div> <p>Vous commencez à comprendre ? Nous pouvons même faire plus simple sans avoir à déclarer notre closure au préalable comme ceci :</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="p">{(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">})</span>
</code></pre></div></div> <p>Toutes les fonctions/closures ayant pour signature “<em>(Int, Int) -&gt; Int</em> “ peuvent être utilisées comme paramètre de <em>op</em>, peu importe que celles-ci aient été déclarées avant ou directement à l’appel.</p> <p>Vous voulez quelques petites astuces syntaxiques pour vous simplifier la vie ? C’est parti !</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="p">{(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">in</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">})</span>
</code></pre></div></div> <p>Vous avez peut-être remarqué mais nous avons omis le type de nos paramètres, et même le type de sortie ! Pourquoi ça fonctionne alors ? Dites merci à l’<a href="https://fr.wikipedia.org/wiki/Inf%C3%A9rence_de_types">inférence de type</a> et non à une magie obscure. Au moment de déclarer la fonction <em>apply</em>, nous avons déjà dit à Swift les types que nous attendions. Swift a automatiquement fait le rapprochement entre ce qu’il attend comme type et ce que vous lui donnez. C’est franchement génial non ? Pourtant nous sommes loin d’avoir vu toutes les simplifications possibles. Next !</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="p">{(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">in</span>
  <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">})</span>
</code></pre></div></div> <p>Pas besoin de return ? Quand il n’y a aucune ambiguïté pour un cas aussi simple, Swift comprend que “<em>x+y</em> “ est la valeur de retour. Bien entendu, vous pouvez mettre autant de code que vous désirez après le “<em>in</em> “, cependant il faudra remettre un “<em>return</em> “ !</p> <p>C’est pas encore fini, nous pouvons encore faire mieux !</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">op</span><span class="p">:</span> <span class="p">{</span><span class="nv">$0</span> <span class="o">+</span> <span class="nv">$1</span><span class="p">})</span>
</code></pre></div></div> <p>J’ai été trop loin ? Testez et vous verrez que ça marche ! Dans ce code, nous n’avons même pas eu besoin de faire une quelconque différence entre signature et corps de fonction. Par le même principe que l’inférence de type, dans cette situation Swift sait ce qu’il attend. Comment récupérons-nous les valeurs de nos paramètres ? “<em>$0</em> “ et “<em>$1</em> “ sont des noms conventionnels que Swift utilise par défaut, prenant les valeurs des paramètres d’entrée.</p> <p>Un peu perdu ? Reprenons la signature de “<em>op: (Int, Int) -&gt; Int</em> “. Donc “<em>$0</em> “ correspond au premier entier et “<em>$1</em> “ au second. L’ordre est important, car si nous avions par exemple “<em>op: (Int, String) -&gt; Int</em> “, “<em>$1</em> “ serait alors une chaîne de caractères. Swift a donc lié à des noms prédéfinis les valeurs, plutôt que nous donnions nous-mêmes le nom de celle-ci. Pour le “<em>return</em> “ qui n’est pas nécessaire je vous renvoie à ce que j’ai dit plus haut.</p> <p>Encore un petit truc pour la route purement syntaxique, mais qui vous facilitera sûrement la vie !</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">apply</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span> <span class="p">{</span><span class="nv">$0</span> <span class="o">+</span> <span class="nv">$1</span><span class="p">}</span>
</code></pre></div></div> <p>Quand le dernier paramètre de votre fonction est une closure, vous pouvez l’appeler de cette manière. Même pas besoin de donner le nom du paramètre, vous écrivez juste entre accolade votre closure. Toutes les closures vues précédemment fonctionnent avec cette syntaxe.</p> <p>Quand nous manipulons des fonctions aussi simple, vous conviendrez que nous pouvons nous simplifier la vie. Il faut cependant toujours faire attention à la lisibilité.</p> <p>Nous en avons terminé avec cette première partie sur les closures, passons sans plus tarder à l’application partielle !</p> <p><a href="../../../2019/08/10/partial-application-fr.html">Partie 2: L’application partielle</a></p> </div> </article> </div><div class="col-lg-4"> <div class="card"> <div class="card-header"> About Damien Morard </div> <div class="card-body text-dark"> <!-- Your Bio --> <p> Hey, my name is Damien. I am a PhD student at the University of Geneva and researcher in computer science. My research areas include semantics, modeling and verification. Currently, I am working on improving High-level Petri nets by adding a way to use functions as token. My goal is to reduce the semantic gap between an implementation and its model.</p> </div> </div> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#personal"></div> <li class="tag-head"> <a href="/blog/categories/personal">personal</a> </li> <a name="personal"></a> <div id="#tutorial"></div> <li class="tag-head"> <a href="/blog/categories/tutorial">tutorial</a> </li> <a name="tutorial"></a> </div> </div> </div></div> <!-- End of row--> </div><footer> <p> Powered by<a href="https://devlopr.netlify.com/readme"> devlopr jekyll</a>. Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> </div> </body> </html>
